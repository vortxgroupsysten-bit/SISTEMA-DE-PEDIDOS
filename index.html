<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gar√ßom App</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #121212; --card: #1e1e1e; --primary: #ff9f43; --text: #f1f1f1; --success: #1dd1a1; }
        * { box-sizing: border-box; outline: none; }
        body { font-family: 'Poppins', sans-serif; margin: 0; background: var(--bg); color: var(--text); display: flex; flex-direction: column; height: 100vh; }

        /* HEADER & TABS */
        .app-header { padding: 15px; background: #202020; text-align: center; font-weight: bold; border-bottom: 1px solid #333; }
        .view-container { flex: 1; overflow: hidden; position: relative; }
        .view { position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow-y: auto; padding: 20px; display: none; background: var(--bg); }
        .view.active { display: block; }

        /* PEDIDO ESTILOS */
        .category-tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .cat-btn { flex: 1; padding: 10px; background: var(--card); border: 1px solid #333; color: #aaa; border-radius: 8px; cursor: pointer; }
        .cat-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        
        .product-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; padding-bottom: 80px; }
        .product-card { background: var(--card); padding: 15px; border-radius: 10px; border: 1px solid #333; display: flex; flex-direction: column; justify-content: space-between; height: 140px; }
        .btn-add { background: #333; color: white; border: none; padding: 8px; width: 100%; border-radius: 5px; margin-top: auto; }
        
        /* BOTTOM BAR DO CARRINHO */
        .cart-bar { position: fixed; bottom: 60px; left: 0; width: 100%; background: #252525; padding: 15px; border-top: 1px solid var(--primary); display: flex; justify-content: space-between; align-items: center; z-index: 10; transform: translateY(100%); transition: 0.3s; }
        .cart-bar.show { transform: translateY(0); }

        /* ABA MESAS/PAGAMENTO */
        .search-bar { width: 100%; padding: 12px; background: #2a2a2a; border: 1px solid #444; border-radius: 8px; color: white; margin-bottom: 20px; font-size: 1rem; }
        .table-card { background: var(--card); padding: 20px; border-radius: 10px; margin-bottom: 15px; border-left: 5px solid var(--success); display: flex; justify-content: space-between; align-items: center; }
        .btn-pay-table { background: var(--success); color: white; border: none; padding: 10px 20px; border-radius: 6px; font-weight: bold; cursor: pointer; }

        /* NAVIGATION FOOTER */
        .nav-footer { height: 60px; background: #181818; border-top: 1px solid #333; display: flex; position: fixed; bottom: 0; width: 100%; z-index: 20; }
        .nav-item { flex: 1; background: none; border: none; color: #777; font-size: 0.8rem; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .nav-item span { font-size: 1.2rem; margin-bottom: 2px; }
        .nav-item.active { color: var(--primary); }

        /* MODAL DE PAGAMENTO (REUTILIZAVEL) */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 50; justify-content: center; align-items: center; }
        .modal-content { background: #222; width: 90%; max-width: 400px; padding: 20px; border-radius: 10px; border: 1px solid #444; }
        
        /* Notifica√ß√µes */
        #notification-area { position: fixed; top: 10px; right: 10px; z-index: 100; }
        .toast { background: #333; border-left: 4px solid var(--success); padding: 15px; margin-bottom: 10px; border-radius: 4px; animation: slideIn 0.3s; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
    </style>
</head>
<body>

    <div id="notification-area"></div>

    <div class="view-container">
        <div id="view-order" class="view active">
            <div class="app-header">Novo Pedido</div>
            
            <div style="padding: 15px 0;">
                <input type="text" id="waiter-name" class="search-bar" placeholder="Seu Nome (Obrigat√≥rio)" style="margin-bottom: 10px;">
                <input type="number" id="table-num" class="search-bar" placeholder="N√∫mero da Mesa">
            </div>

            <div class="category-tabs">
                <button class="cat-btn active" onclick="filterCat('food')">üçî Comida</button>
                <button class="cat-btn" onclick="filterCat('drink')">ü•§ Bebida</button>
            </div>

            <div id="products-container" class="product-list"></div>
        </div>

        <div id="view-bills" class="view">
            <div class="app-header">Gerenciar Mesas</div>
            <div style="margin-top: 15px;">
                <input type="text" id="search-table" class="search-bar" placeholder="üîç Pesquisar mesa..." onkeyup="renderActiveTables()">
            </div>
            <div id="active-tables-list">
                </div>
        </div>
    </div>

    <div class="cart-bar" id="cart-bar">
        <div>
            <div style="font-size: 0.8rem; color: #ccc;">Total do Pedido</div>
            <div style="font-size: 1.2rem; font-weight: bold; color: var(--primary);">R$ <span id="cart-total">0.00</span></div>
        </div>
        <button onclick="sendOrder()" style="background: var(--success); color: white; border: none; padding: 10px 20px; border-radius: 6px; font-weight: bold;">ENVIAR</button>
    </div>

    <div class="nav-footer">
        <button class="nav-item active" onclick="switchView('order')">
            <span>üìù</span> Pedido
        </button>
        <button class="nav-item" onclick="switchView('bills')">
            <span>üí∏</span> Mesas/Pgto
        </button>
    </div>

    <script>
        // DADOS
        const products = [
            { id: 1, name: "X-Burger", price: 25.00, type: "food" },
            { id: 2, name: "Fritas", price: 15.00, type: "food" },
            { id: 3, name: "Pizza", price: 32.00, type: "food" },
            { id: 4, name: "Coca-Cola", price: 6.00, type: "drink" },
            { id: 5, name: "Suco", price: 8.00, type: "drink" },
            { id: 6, name: "Cerveja", price: 12.00, type: "drink" }
        ];
        let cart = [];

        // INICIALIZA√á√ÉO
        window.onload = () => {
            renderProducts('food');
            setInterval(checkNotifications, 3000);
            // Salvar nome do gar√ßom para n√£o digitar toda hora
            if(localStorage.getItem('savedWaiter')) {
                document.getElementById('waiter-name').value = localStorage.getItem('savedWaiter');
            }
        };

        // --- NAVEGA√á√ÉO ---
        function switchView(viewName) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            document.getElementById(`view-${viewName}`).classList.add('active');
            // Ativa o bot√£o correto (logica simples baseada na ordem)
            const btnIndex = viewName === 'order' ? 0 : 1;
            document.querySelectorAll('.nav-item')[btnIndex].classList.add('active');

            if(viewName === 'bills') renderActiveTables();
        }

        // --- ABA 1: PEDIDOS ---
        function filterCat(type) {
            document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            renderProducts(type);
        }

        function renderProducts(type) {
            const container = document.getElementById('products-container');
            container.innerHTML = '';
            products.filter(p => p.type === type).forEach(p => {
                container.innerHTML += `
                    <div class="product-card">
                        <div>
                            <strong>${p.name}</strong><br>
                            <span style="color:var(--primary)">R$ ${p.price.toFixed(2)}</span>
                        </div>
                        <button class="btn-add" onclick="addToCart(${p.id})">Adicionar</button>
                    </div>`;
            });
        }

        function addToCart(id) {
            const item = products.find(p => p.id === id);
            cart.push(item);
            updateCartUI();
        }

        function updateCartUI() {
            const total = cart.reduce((acc, i) => acc + i.price, 0);
            document.getElementById('cart-total').innerText = total.toFixed(2);
            
            const bar = document.getElementById('cart-bar');
            if(cart.length > 0) bar.classList.add('show');
            else bar.classList.remove('show');
        }

        function sendOrder() {
            const waiter = document.getElementById('waiter-name').value;
            const table = document.getElementById('table-num').value;

            if(!waiter || !table) return alert("Preencha Gar√ßom e Mesa!");
            
            // Salva nome para proxima vez
            localStorage.setItem('savedWaiter', waiter);

            // Agrupar itens iguais
            const groupedItems = [];
            cart.forEach(item => {
                const existing = groupedItems.find(i => i.id === item.id);
                if(existing) existing.qty++;
                else groupedItems.push({...item, qty: 1});
            });

            const order = {
                id: Date.now(),
                table, waiter,
                items: groupedItems,
                time: new Date().toLocaleTimeString('pt-BR', {hour:'2-digit', minute:'2-digit'})
            };

            const orders = JSON.parse(localStorage.getItem('restaurantOrders')) || [];
            orders.push(order);
            localStorage.setItem('restaurantOrders', JSON.stringify(orders));

            cart = [];
            updateCartUI();
            alert("Pedido Enviado!");
        }

        // --- ABA 2: MESAS ATIVAS ---
        function renderActiveTables() {
            const container = document.getElementById('active-tables-list');
            const search = document.getElementById('search-table').value;
            const tabs = JSON.parse(localStorage.getItem('restaurantTabs')) || {};
            const tables = Object.keys(tabs);

            container.innerHTML = '';
            
            if(tables.length === 0) {
                container.innerHTML = '<p style="text-align:center; color:#777; margin-top:30px;">Nenhuma mesa ativa.</p>';
                return;
            }

            tables.forEach(t => {
                if(search && !t.includes(search)) return; // Filtro de busca

                const total = tabs[t].reduce((acc, i) => acc + (i.price * i.qty), 0);
                
                container.innerHTML += `
                    <div class="table-card">
                        <div>
                            <div style="font-size:1.2rem; font-weight:bold;">Mesa ${t}</div>
                            <div style="color:#aaa;">Total: R$ ${total.toFixed(2)}</div>
                        </div>
                        <button class="btn-pay-table" onclick="payTable('${t}')">Receber / Fechar</button>
                    </div>`;
            });
        }

        function payTable(tableNum) {
            if(!confirm(`Confirmar recebimento da Mesa ${tableNum}?`)) return;

            const tabs = JSON.parse(localStorage.getItem('restaurantTabs'));
            const items = tabs[tableNum];
            const history = JSON.parse(localStorage.getItem('restaurantSalesHistory')) || [];

            // 1. Salvar no hist√≥rico Financeiro (Mesma logica do painel)
            items.forEach(item => {
                history.push({
                    waiter: item.waiter || 'App',
                    amount: item.price * item.qty,
                    item: item.name,
                    time: new Date().toLocaleTimeString()
                });
            });
            localStorage.setItem('restaurantSalesHistory', JSON.stringify(history));

            // 2. Apagar conta
            delete tabs[tableNum];
            localStorage.setItem('restaurantTabs', JSON.stringify(tabs));

            renderActiveTables();
            alert("Pagamento confirmado!");
        }

        // --- NOTIFICA√á√ïES ---
        function checkNotifications() {
            const notifs = JSON.parse(localStorage.getItem('restaurantNotifications')) || [];
            if(notifs.length > 0) {
                // Filtra notifica√ß√µes apenas para o gar√ßom atual (opcional, aqui mostra todas)
                notifs.forEach(n => {
                    const div = document.createElement('div');
                    div.className = 'toast';
                    div.innerHTML = `<strong>üîî Cozinha:</strong> ${n.msg}<br><small>Para: ${n.waiter}</small>`;
                    document.getElementById('notification-area').appendChild(div);
                    setTimeout(() => div.remove(), 5000);
                });
                localStorage.setItem('restaurantNotifications', '[]'); // Limpa
                
                // Toca som
                new Audio('https://actions.google.com/sounds/v1/alarms/beep_short.ogg').play().catch(()=>{});
            }
        }
    </script>
</body>
</html>
