<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gar√ßom App</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Cores Base (Fallbacks) */
            --bg-solid: #0f111a;
            --surface-solid: #1f242e;
            /* Cores de A√ß√£o */
            --primary: #ff9f43;
            --success: #2ecc71;
            --danger: #e74c3c;
            --text: #ffffff;
            --text-sub: #d0d0d0; /* Texto ligeiramente mais claro para contraste */
            --border: rgba(255, 255, 255, 0.1); /* Borda mais sutil */
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; margin: 0; padding: 0; }
        
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg-solid); /* Cor de fundo de seguran√ßa */
            color: var(--text); 
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden;
            position: relative; /* Necess√°rio para o fundo funcionar */
        }

        /* --- NOVO: IMAGEM DE FUNDO COM BLUR --- */
        body::before {
            content: "";
            position: fixed; /* Fica fixo atr√°s de tudo */
            top: 0; left: 0; right: 0; bottom: 0;
            z-index: -1; /* Garante que fique atr√°s do conte√∫do */
            
            /* Imagem de Bar/Restaurante (Exemplo do Unsplash) */
            background-image: url('https://images.unsplash.com/photo-1572116469696-31de0f17cc34?q=80&w=1974&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            
            /* O Efeito Blur */
            filter: blur(12px) brightness(0.4); /* Blur forte e escurecido para leitura */
            transform: scale(1.1); /* Aumenta um pouco para esconder as bordas do blur */
        }

        /* --- HEADER --- */
        /* Ajustado para ser mais transl√∫cido */
        .app-header { background: rgba(15, 17, 26, 0.85); backdrop-filter: blur(15px); padding: 15px; border-bottom: 1px solid var(--border); z-index: 10; position: fixed; top: 0; width: 100%; box-shadow: 0 4px 20px rgba(0,0,0,0.2); }
        .input-row { display: flex; gap: 10px; margin-bottom: 12px; }
        input { background: rgba(0, 0, 0, 0.5); border: 1px solid var(--border); color: white; padding: 12px; border-radius: 8px; font-size: 16px; font-weight: 500; width: 100%; }
        input:focus { border-color: var(--primary); background: rgba(0, 0, 0, 0.7); }
        .tabs { display: flex; background: rgba(0, 0, 0, 0.3); padding: 4px; border-radius: 10px; }
        .tab-btn { flex: 1; padding: 10px; border: none; background: transparent; color: var(--text-sub); font-weight: 600; font-size: 0.9rem; border-radius: 8px; transition: 0.2s; }
        .tab-btn.active { background: rgba(255, 159, 67, 0.2); color: var(--primary); }

        /* --- CONTENT --- */
        .content-area { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: 100px; margin-top: 130px; -webkit-overflow-scrolling: touch; }

        /* --- PRODUTO CARD --- */
        /* Agora com fundo semi-transparente para efeito vidro */
        .product-item { display: flex; align-items: center; justify-content: space-between; background: rgba(31, 36, 46, 0.75); backdrop-filter: blur(5px); padding: 16px; margin-bottom: 12px; border-radius: 12px; border: 1px solid var(--border); position: relative; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .product-item:active { transform: scale(0.98); background: rgba(31, 36, 46, 0.9); }
        .prod-info h3 { font-size: 1rem; font-weight: 600; margin-bottom: 4px; text-shadow: 0 1px 2px rgba(0,0,0,0.5); }
        .prod-info .price { color: var(--primary); font-weight: 700; font-size: 1.1rem; }
        
        .btn-add-icon { background: rgba(255,255,255,0.1); color: #fff; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: bold; border: 1px solid var(--border); }
        
        /* Contador (Bolinha vermelha no card) */
        .qty-badge { position: absolute; top: -8px; right: -8px; background: var(--danger); color: white; font-size: 0.75rem; font-weight: bold; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 2px solid var(--surface-solid); opacity: 0; transform: scale(0); transition: 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.3); }
        .qty-badge.visible { opacity: 1; transform: scale(1); }

        /* --- BARRA INFERIOR (RESUMO) --- */
        .order-bar { position: fixed; bottom: 80px; left: 15px; right: 15px; background: var(--success); color: white; padding: 15px; border-radius: 16px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); transform: translateY(150%); transition: 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); z-index: 50; cursor: pointer; }
        .order-bar.visible { transform: translateY(0); }
        .order-bar-info { display: flex; align-items: center; gap: 10px; font-weight: 600; }
        .order-count { background: rgba(0,0,0,0.2); padding: 2px 8px; border-radius: 10px; font-size: 0.85rem; }

        /* --- SACOLA (BOTTOM SHEET) --- */
        .cart-sheet-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 60; opacity: 0; pointer-events: none; transition: 0.3s; backdrop-filter: blur(5px); }
        .cart-sheet-overlay.open { opacity: 1; pointer-events: all; }
        
        .cart-sheet { position: fixed; bottom: 0; left: 0; width: 100%; background: #161b22; border-top-left-radius: 20px; border-top-right-radius: 20px; padding: 20px; z-index: 70; transform: translateY(100%); transition: 0.3s cubic-bezier(0.16, 1, 0.3, 1); max-height: 80vh; display: flex; flex-direction: column; box-shadow: 0 -10px 40px rgba(0,0,0,0.5); }
        .cart-sheet.open { transform: translateY(0); }

        .cart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--border); }
        .cart-items-container { overflow-y: auto; flex: 1; margin-bottom: 20px; }
        
        .cart-item-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; background: rgba(31, 36, 46, 0.6); padding: 10px; border-radius: 8px; border: 1px solid var(--border); }
        .cart-controls { display: flex; align-items: center; gap: 15px; background: rgba(0,0,0,0.3); padding: 5px 10px; border-radius: 20px; }
        .ctrl-btn { width: 30px; height: 30px; border-radius: 50%; border: none; background: rgba(255,255,255,0.1); color: white; font-weight: bold; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; }
        .ctrl-btn.minus { color: var(--danger); }
        .ctrl-btn.plus { color: var(--success); }

        .btn-confirm-order { width: 100%; background: var(--success); color: white; padding: 15px; border-radius: 12px; font-size: 1.1rem; font-weight: bold; border: none; box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3); }

        /* --- NAVBAR --- */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; height: 60px; background: rgba(22, 27, 34, 0.95); backdrop-filter: blur(10px); border-top: 1px solid var(--border); display: flex; z-index: 40; }
        .nav-item { flex: 1; background: none; border: none; color: var(--text-sub); font-size: 0.75rem; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px; }
        .nav-item.active { color: var(--primary); }
        .nav-item svg { width: 24px; fill: currentColor; }

        .hidden { display: none !important; }
        .table-card { background: rgba(31, 36, 46, 0.75); backdrop-filter: blur(5px); padding: 15px; margin-bottom: 10px; border-radius: 10px; border-left: 4px solid var(--success); display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--border); }
    </style>
</head>
<body>

    <div class="app-header" id="header-order">
        <div class="input-row">
            <input type="text" id="waiter-name" placeholder="Seu Nome" spellcheck="false">
            <input type="tel" id="table-num" placeholder="Mesa" maxlength="3" style="width: 80px; text-align: center;">
        </div>
        <div class="tabs">
            <button class="tab-btn active" onclick="App.filter('food', this)">COMIDA</button>
            <button class="tab-btn" onclick="App.filter('drink', this)">BEBIDA</button>
        </div>
    </div>

    <section id="screen-order" class="content-area"></section>

    <section id="screen-bills" class="content-area hidden" style="margin-top: 60px;">
        <h2 style="margin-bottom: 15px; text-shadow: 0 1px 3px rgba(0,0,0,0.5);">Mesas Abertas</h2>
        <input type="text" placeholder="üîé Filtrar mesa..." style="margin-bottom:15px;" onkeyup="App.renderTables(this.value)">
        <div id="tables-list"></div>
    </section>

    <div id="order-bar" class="order-bar" onclick="Cart.open()">
        <div class="order-bar-info">
            <span class="order-count" id="bar-count">0</span>
            <span>Ver Sacola</span>
        </div>
        <div id="bar-total" style="font-weight: 800; font-size: 1.1rem;">R$ 0,00</div>
    </div>

    <div class="cart-sheet-overlay" id="cart-overlay" onclick="Cart.close()"></div>
    <div class="cart-sheet" id="cart-sheet">
        <div class="cart-header">
            <h3>Revisar Pedido</h3>
            <button onclick="Cart.close()" style="background:none; border:none; color:var(--text-sub); font-size:1.5rem; padding: 5px;">‚úï</button>
        </div>
        <div class="cart-items-container" id="cart-list">
            </div>
        <div style="display:flex; justify-content:space-between; margin-bottom:15px; font-weight:bold; font-size:1.2rem;">
            <span>Total</span>
            <span id="sheet-total" style="color:var(--success)">R$ 0,00</span>
        </div>
        <button class="btn-confirm-order" onclick="App.sendOrder()">ENVIAR PEDIDO üöÄ</button>
    </div>

    <nav class="bottom-nav">
        <button class="nav-item active" onclick="App.nav('order', this)">
            <svg viewBox="0 0 24 24"><path d="M11 9H9V2H7v7H5V2H3v7c0 2.12 1.66 3.84 3.75 3.97V22h2.5v-9.03C11.34 12.84 13 11.12 13 9V2h-2v7zm5-3v8h2.5v8H21V2c-2.76 0-5 2.24-5 4z"/></svg>
            Card√°pio
        </button>
        <button class="nav-item" onclick="App.nav('bills', this)">
            <svg viewBox="0 0 24 24"><path d="M14 10H2v2h12v-2zm0-4H2v2h12V6zm4 8v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zM2 16h8v-2H2v2z"/></svg>
            Mesas
        </button>
    </nav>

    <script>
        // --- DADOS E FUN√á√ïES UTILIT√ÅRIAS ---
        const DB = {
            products: [
                { id: 1, name: "X-Burger Artesanal", price: 28.00, type: "food" },
                { id: 2, name: "Batata Frita R√∫stica", price: 18.00, type: "food" },
                { id: 3, name: "Pizza Marguerita (Fatia)", price: 14.00, type: "food" },
                { id: 4, name: "Por√ß√£o de Past√©is (6un)", price: 22.00, type: "food" },
                { id: 5, name: "Coca-Cola Lata 350ml", price: 7.00, type: "drink" },
                { id: 6, name: "Suco Natural Laranja", price: 10.00, type: "drink" },
                { id: 7, name: "Cerveja Heineken Long Neck", price: 14.00, type: "drink" },
                { id: 8, name: "√Ågua Sem G√°s 500ml", price: 5.00, type: "drink" }
            ],
            cart: [], // Array de objetos {id, qty, ...}
            get: (k) => JSON.parse(localStorage.getItem(k)) || [],
            set: (k,v) => localStorage.setItem(k, JSON.stringify(v))
        };

        // --- L√ìGICA PRINCIPAL DO APP ---
        const App = {
            init: () => {
                const saved = localStorage.getItem('waiterName');
                if(saved) document.getElementById('waiter-name').value = saved;
                App.renderProducts('food');
                setInterval(App.checkNotifs, 3000);
            },

            renderProducts: (type) => {
                const container = document.getElementById('screen-order');
                container.innerHTML = '';
                DB.products.filter(p => p.type === type).forEach(p => {
                    // Verifica quantos tem no carrinho para mostrar a bolinha (badge)
                    const inCart = DB.cart.find(i => i.id === p.id);
                    const qty = inCart ? inCart.qty : 0;
                    const badgeClass = qty > 0 ? 'qty-badge visible' : 'qty-badge';

                    container.innerHTML += `
                        <div class="product-item" onclick="App.addOne(${p.id})">
                            <div class="prod-info">
                                <h3>${p.name}</h3>
                                <div class="price">R$ ${p.price.toFixed(2)}</div>
                            </div>
                            <div class="btn-add-icon">+</div>
                            <div id="badge-${p.id}" class="${badgeClass}">${qty}</div>
                        </div>
                    `;
                });
            },

            addOne: (id) => {
                const item = DB.products.find(p => p.id === id);
                const exists = DB.cart.find(i => i.id === id);
                
                if(exists) {
                    exists.qty++;
                } else {
                    DB.cart.push({ ...item, qty: 1 });
                }

                // Atualiza UI
                const badge = document.getElementById(`badge-${id}`);
                if(badge) {
                    badge.innerText = exists ? exists.qty : 1;
                    badge.classList.add('visible');
                }
                App.updateBar();
                if(navigator.vibrate) navigator.vibrate(40); // Vibra√ß√£o t√°til
            },

            updateBar: () => {
                const total = DB.cart.reduce((acc, i) => acc + (i.price * i.qty), 0);
                const count = DB.cart.reduce((acc, i) => acc + i.qty, 0);

                document.getElementById('bar-total').innerText = `R$ ${total.toFixed(2)}`;
                document.getElementById('bar-count').innerText = count;

                const bar = document.getElementById('order-bar');
                if(count > 0) bar.classList.add('visible');
                else {
                    bar.classList.remove('visible');
                    Cart.close(); // Fecha sacola se esvaziar
                }
            },

            filter: (type, btn) => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                App.renderProducts(type);
            },

            sendOrder: () => {
                const waiter = document.getElementById('waiter-name').value.trim();
                const table = document.getElementById('table-num').value.trim();

                if(!waiter || !table) {
                    if(navigator.vibrate) navigator.vibrate([100,50,100]);
                    return alert("‚ö†Ô∏è Preencha seu Nome e o n√∫mero da Mesa!");
                }

                localStorage.setItem('waiterName', waiter);

                const order = {
                    id: Date.now(),
                    table, waiter,
                    items: DB.cart, // J√° est√° agrupado com qtd
                    time: new Date().toLocaleTimeString('pt-BR', {hour:'2-digit', minute:'2-digit'})
                };

                const orders = DB.get('restaurantOrders');
                orders.push(order);
                DB.set('restaurantOrders', orders);

                // Reset
                DB.cart = [];
                App.updateBar();
                App.renderProducts(document.querySelector('.tab-btn.active').innerText === 'COMIDA' ? 'food' : 'drink');
                Cart.close();
                document.getElementById('table-num').value = '';
                alert("Pedido Enviado para Cozinha! üöÄ");
            },

            // --- NAVEGA√á√ÉO ENTRE TELAS ---
            nav: (screen, btn) => {
                document.getElementById('screen-order').classList.add('hidden');
                document.getElementById('screen-bills').classList.add('hidden');
                document.getElementById('header-order').classList.add('hidden');

                document.getElementById('screen-' + screen).classList.remove('hidden');
                
                if(screen === 'order') document.getElementById('header-order').classList.remove('hidden');
                if(screen === 'bills') App.renderTables();

                document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            },

            renderTables: (filter='') => {
                const tabs = JSON.parse(localStorage.getItem('restaurantTabs')) || {};
                const list = document.getElementById('tables-list');
                const keys = Object.keys(tabs);
                list.innerHTML = '';

                if(keys.length === 0) list.innerHTML = '<div style="text-align:center; color:var(--text-sub); margin-top:40px; font-weight:500;">Nenhuma mesa aberta no momento.</div>';

                keys.forEach(t => {
                    if(filter && !t.includes(filter)) return;
                    const total = tabs[t].reduce((acc, i) => acc + (i.price * i.qty), 0);
                    list.innerHTML += `
                        <div class="table-card">
                            <div>
                                <strong style="font-size:1.1rem;">Mesa ${t}</strong><br>
                                <small style="color:var(--text-sub)">Parcial: R$ ${total.toFixed(2)}</small>
                            </div>
                            <button onclick="App.payTable('${t}')" style="background:rgba(46, 204, 113, 0.2); border:1px solid var(--success); color:var(--success); padding:8px 16px; border-radius:8px; font-weight:600;">Fechar Conta</button>
                        </div>
                    `;
                });
            },

            payTable: (t) => {
                if(!confirm(`Confirmar fechamento e pagamento da Mesa ${t}?`)) return;
                const tabs = JSON.parse(localStorage.getItem('restaurantTabs'));
                const items = tabs[t];
                
                // Grava historico
                const hist = DB.get('restaurantSalesHistory');
                items.forEach(i => hist.push({
                    waiter: i.waiter || 'App', amount: i.price*i.qty, item: i.name, time: new Date().toLocaleTimeString()
                }));
                DB.set('restaurantSalesHistory', hist);

                delete tabs[t];
                localStorage.setItem('restaurantTabs', JSON.stringify(tabs));
                App.renderTables();
            },

            checkNotifs: () => {
                const notifs = DB.get('restaurantNotifications');
                if(notifs.length > 0) {
                    notifs.forEach(n => alert(`üîî Cozinha informa:\n${n.msg}`)); // Alert nativo chama mais aten√ß√£o no mobile
                    DB.set('restaurantNotifications', []);
                    if(navigator.vibrate) navigator.vibrate([200,100,200]);
                }
            }
        };

        // --- L√ìGICA DA SACOLA (CART) ---
        const Cart = {
            open: () => {
                const list = document.getElementById('cart-list');
                list.innerHTML = '';
                
                DB.cart.forEach(item => {
                    list.innerHTML += `
                        <div class="cart-item-row">
                            <div style="flex:1">
                                <strong style="font-size:0.95rem">${item.name}</strong><br>
                                <small style="color:var(--text-sub)">R$ ${item.price.toFixed(2)}</small>
                            </div>
                            <div class="cart-controls">
                                <button class="ctrl-btn minus" onclick="Cart.change(${item.id}, -1)">Ôºç</button>
                                <span style="font-weight:bold; width:24px; text-align:center;">${item.qty}</span>
                                <button class="ctrl-btn plus" onclick="Cart.change(${item.id}, 1)">Ôºã</button>
                            </div>
                        </div>
                    `;
                });

                const total = DB.cart.reduce((acc, i) => acc + (i.price * i.qty), 0);
                document.getElementById('sheet-total').innerText = `R$ ${total.toFixed(2)}`;

                document.getElementById('cart-overlay').classList.add('open');
                document.getElementById('cart-sheet').classList.add('open');
            },

            close: () => {
                document.getElementById('cart-overlay').classList.remove('open');
                document.getElementById('cart-sheet').classList.remove('open');
                // Atualiza os badges na lista principal
                App.renderProducts(document.querySelector('.tab-btn.active').innerText === 'COMIDA' ? 'food' : 'drink');
            },

            change: (id, delta) => {
                const item = DB.cart.find(i => i.id === id);
                item.qty += delta;

                if(item.qty <= 0) {
                    DB.cart = DB.cart.filter(i => i.id !== id);
                }

                App.updateBar(); 
                
                if(DB.cart.length === 0) {
                    Cart.close();
                } else {
                    Cart.open(); // Re-renderiza a lista da sacola
                }
                if(navigator.vibrate) navigator.vibrate(30);
            }
        };

        // Inicia o App
        window.onload = App.init;
    </script>
</body>
</html>
