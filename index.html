<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GarÃ§om App</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0f111a; --surface: #1f242e; --primary: #ff9f43;
            --success: #2ecc71; --danger: #e74c3c; --text: #ffffff;
            --text-sub: #a0a0a0; --border: #2d3342;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; margin: 0; padding: 0; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* --- HEADER --- */
        .app-header { background: rgba(31, 36, 46, 0.95); backdrop-filter: blur(10px); padding: 15px; border-bottom: 1px solid var(--border); z-index: 10; position: fixed; top: 0; width: 100%; }
        .input-row { display: flex; gap: 10px; margin-bottom: 12px; }
        input { background: #161b22; border: 1px solid var(--border); color: white; padding: 12px; border-radius: 8px; font-size: 16px; font-weight: 500; width: 100%; }
        input:focus { border-color: var(--primary); }
        .tabs { display: flex; background: #161b22; padding: 4px; border-radius: 10px; }
        .tab-btn { flex: 1; padding: 10px; border: none; background: transparent; color: var(--text-sub); font-weight: 600; font-size: 0.9rem; border-radius: 8px; transition: 0.2s; }
        .tab-btn.active { background: var(--surface); color: var(--primary); }

        /* --- CONTENT --- */
        .content-area { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: 100px; margin-top: 130px; -webkit-overflow-scrolling: touch; }

        /* --- PRODUTO CARD --- */
        .product-item { display: flex; align-items: center; justify-content: space-between; background: var(--surface); padding: 16px; margin-bottom: 12px; border-radius: 12px; border: 1px solid var(--border); position: relative; }
        .product-item:active { transform: scale(0.98); background: #252b36; }
        .prod-info h3 { font-size: 1rem; font-weight: 600; margin-bottom: 4px; }
        .prod-info .price { color: var(--primary); font-weight: 700; font-size: 1.1rem; }
        
        .btn-add-icon { background: var(--border); color: #fff; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: bold; }
        
        /* Contador (Bolinha vermelha no card) */
        .qty-badge { position: absolute; top: -8px; right: -8px; background: var(--danger); color: white; font-size: 0.75rem; font-weight: bold; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 2px solid var(--bg); opacity: 0; transform: scale(0); transition: 0.2s; }
        .qty-badge.visible { opacity: 1; transform: scale(1); }

        /* --- BARRA INFERIOR (RESUMO) --- */
        .order-bar { position: fixed; bottom: 80px; left: 15px; right: 15px; background: var(--success); color: white; padding: 15px; border-radius: 16px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); transform: translateY(150%); transition: 0.3s; z-index: 50; cursor: pointer; }
        .order-bar.visible { transform: translateY(0); }
        .order-bar-info { display: flex; align-items: center; gap: 10px; font-weight: 600; }
        .order-count { background: rgba(0,0,0,0.2); padding: 2px 8px; border-radius: 10px; font-size: 0.85rem; }

        /* --- SACOLA (BOTTOM SHEET) --- */
        .cart-sheet-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 60; opacity: 0; pointer-events: none; transition: 0.3s; backdrop-filter: blur(2px); }
        .cart-sheet-overlay.open { opacity: 1; pointer-events: all; }
        
        .cart-sheet { position: fixed; bottom: 0; left: 0; width: 100%; background: #161b22; border-top-left-radius: 20px; border-top-right-radius: 20px; padding: 20px; z-index: 70; transform: translateY(100%); transition: 0.3s cubic-bezier(0.16, 1, 0.3, 1); max-height: 80vh; display: flex; flex-direction: column; }
        .cart-sheet.open { transform: translateY(0); }

        .cart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--border); }
        .cart-items-container { overflow-y: auto; flex: 1; margin-bottom: 20px; }
        
        .cart-item-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; background: var(--surface); padding: 10px; border-radius: 8px; }
        .cart-controls { display: flex; align-items: center; gap: 15px; background: var(--bg); padding: 5px 10px; border-radius: 20px; }
        .ctrl-btn { width: 30px; height: 30px; border-radius: 50%; border: none; background: #333; color: white; font-weight: bold; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; }
        .ctrl-btn.minus { color: var(--danger); }
        .ctrl-btn.plus { color: var(--success); }

        .btn-confirm-order { width: 100%; background: var(--success); color: white; padding: 15px; border-radius: 12px; font-size: 1.1rem; font-weight: bold; border: none; }

        /* --- NAVBAR --- */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; height: 60px; background: #161b22; border-top: 1px solid var(--border); display: flex; z-index: 40; }
        .nav-item { flex: 1; background: none; border: none; color: #555; font-size: 0.75rem; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px; }
        .nav-item.active { color: var(--primary); }
        .nav-item svg { width: 24px; fill: currentColor; }

        .hidden { display: none !important; }
        .table-card { background: var(--surface); padding: 15px; margin-bottom: 10px; border-radius: 10px; border-left: 4px solid var(--success); display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>

    <div class="app-header" id="header-order">
        <div class="input-row">
            <input type="text" id="waiter-name" placeholder="Seu Nome">
            <input type="tel" id="table-num" placeholder="Mesa" maxlength="3" style="width: 80px; text-align: center;">
        </div>
        <div class="tabs">
            <button class="tab-btn active" onclick="App.filter('food', this)">COMIDA</button>
            <button class="tab-btn" onclick="App.filter('drink', this)">BEBIDA</button>
        </div>
    </div>

    <section id="screen-order" class="content-area"></section>

    <section id="screen-bills" class="content-area hidden" style="margin-top: 60px;">
        <h2 style="margin-bottom: 15px;">Mesas Abertas</h2>
        <input type="text" placeholder="Filtrar mesa..." style="margin-bottom:15px;" onkeyup="App.renderTables(this.value)">
        <div id="tables-list"></div>
    </section>

    <div id="order-bar" class="order-bar" onclick="Cart.open()">
        <div class="order-bar-info">
            <span class="order-count" id="bar-count">0</span>
            <span>Ver Sacola</span>
        </div>
        <div id="bar-total">R$ 0,00</div>
    </div>

    <div class="cart-sheet-overlay" id="cart-overlay" onclick="Cart.close()"></div>
    <div class="cart-sheet" id="cart-sheet">
        <div class="cart-header">
            <h3>Revisar Pedido</h3>
            <button onclick="Cart.close()" style="background:none; border:none; color:#777; font-size:1.5rem;">âœ•</button>
        </div>
        <div class="cart-items-container" id="cart-list">
            </div>
        <div style="display:flex; justify-content:space-between; margin-bottom:15px; font-weight:bold; font-size:1.2rem;">
            <span>Total</span>
            <span id="sheet-total" style="color:var(--success)">R$ 0,00</span>
        </div>
        <button class="btn-confirm-order" onclick="App.sendOrder()">ENVIAR PEDIDO ðŸš€</button>
    </div>

    <nav class="bottom-nav">
        <button class="nav-item active" onclick="App.nav('order', this)">
            <svg viewBox="0 0 24 24"><path d="M11 9H9V2H7v7H5V2H3v7c0 2.12 1.66 3.84 3.75 3.97V22h2.5v-9.03C11.34 12.84 13 11.12 13 9V2h-2v7zm5-3v8h2.5v8H21V2c-2.76 0-5 2.24-5 4z"/></svg>
            CardÃ¡pio
        </button>
        <button class="nav-item" onclick="App.nav('bills', this)">
            <svg viewBox="0 0 24 24"><path d="M14 10H2v2h12v-2zm0-4H2v2h12V6zm4 8v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zM2 16h8v-2H2v2z"/></svg>
            Mesas
        </button>
    </nav>

    <script>
        const DB = {
            products: [
                { id: 1, name: "X-Burger", price: 25.00, type: "food" },
                { id: 2, name: "Batata Frita", price: 15.00, type: "food" },
                { id: 3, name: "Pizza Fatia", price: 12.00, type: "food" },
                { id: 4, name: "Pastel", price: 8.00, type: "food" },
                { id: 5, name: "Coca-Cola", price: 6.00, type: "drink" },
                { id: 6, name: "Suco", price: 8.00, type: "drink" },
                { id: 7, name: "Cerveja", price: 10.00, type: "drink" },
                { id: 8, name: "Ãgua", price: 4.00, type: "drink" }
            ],
            cart: [], // Array de objetos {id, qty, ...}
            get: (k) => JSON.parse(localStorage.getItem(k)) || [],
            set: (k,v) => localStorage.setItem(k, JSON.stringify(v))
        };

        const App = {
            init: () => {
                const saved = localStorage.getItem('waiterName');
                if(saved) document.getElementById('waiter-name').value = saved;
                App.renderProducts('food');
                setInterval(App.checkNotifs, 3000);
            },

            renderProducts: (type) => {
                const container = document.getElementById('screen-order');
                container.innerHTML = '';
                DB.products.filter(p => p.type === type).forEach(p => {
                    // Verifica quantos tem no carrinho para mostrar a bolinha (badge)
                    const inCart = DB.cart.find(i => i.id === p.id);
                    const qty = inCart ? inCart.qty : 0;
                    const badgeClass = qty > 0 ? 'qty-badge visible' : 'qty-badge';

                    container.innerHTML += `
                        <div class="product-item" onclick="App.addOne(${p.id})">
                            <div class="prod-info">
                                <h3>${p.name}</h3>
                                <div class="price">R$ ${p.price.toFixed(2)}</div>
                            </div>
                            <div class="btn-add-icon">+</div>
                            <div id="badge-${p.id}" class="${badgeClass}">${qty}</div>
                        </div>
                    `;
                });
            },

            addOne: (id) => {
                const item = DB.products.find(p => p.id === id);
                const exists = DB.cart.find(i => i.id === id);
                
                if(exists) {
                    exists.qty++;
                } else {
                    DB.cart.push({ ...item, qty: 1 });
                }

                // Atualiza UI
                const badge = document.getElementById(`badge-${id}`);
                if(badge) {
                    badge.innerText = exists ? exists.qty : 1;
                    badge.classList.add('visible');
                }
                App.updateBar();
                if(navigator.vibrate) navigator.vibrate(30);
            },

            updateBar: () => {
                const total = DB.cart.reduce((acc, i) => acc + (i.price * i.qty), 0);
                const count = DB.cart.reduce((acc, i) => acc + i.qty, 0);

                document.getElementById('bar-total').innerText = `R$ ${total.toFixed(2)}`;
                document.getElementById('bar-count').innerText = count;

                const bar = document.getElementById('order-bar');
                if(count > 0) bar.classList.add('visible');
                else {
                    bar.classList.remove('visible');
                    Cart.close(); // Fecha sacola se esvaziar
                }
            },

            filter: (type, btn) => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                App.renderProducts(type);
            },

            sendOrder: () => {
                const waiter = document.getElementById('waiter-name').value;
                const table = document.getElementById('table-num').value;

                if(!waiter || !table) return alert("Preencha GarÃ§om e Mesa!");

                localStorage.setItem('waiterName', waiter);

                const order = {
                    id: Date.now(),
                    table, waiter,
                    items: DB.cart, // JÃ¡ estÃ¡ agrupado com qtd
                    time: new Date().toLocaleTimeString('pt-BR', {hour:'2-digit', minute:'2-digit'})
                };

                const orders = DB.get('restaurantOrders');
                orders.push(order);
                DB.set('restaurantOrders', orders);

                DB.cart = [];
                App.updateBar();
                App.renderProducts('food'); // Reseta badges
                Cart.close();
                document.getElementById('table-num').value = '';
                alert("Pedido Enviado! ðŸš€");
            },

            // --- NAVEGAÃ‡ÃƒO ENTRE TELAS ---
            nav: (screen, btn) => {
                document.getElementById('screen-order').classList.add('hidden');
                document.getElementById('screen-bills').classList.add('hidden');
                document.getElementById('header-order').classList.add('hidden');

                document.getElementById('screen-' + screen).classList.remove('hidden');
                
                if(screen === 'order') document.getElementById('header-order').classList.remove('hidden');
                if(screen === 'bills') App.renderTables();

                document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            },

            renderTables: (filter='') => {
                const tabs = JSON.parse(localStorage.getItem('restaurantTabs')) || {};
                const list = document.getElementById('tables-list');
                const keys = Object.keys(tabs);
                list.innerHTML = '';

                if(keys.length === 0) list.innerHTML = '<div style="text-align:center; color:#777">Sem mesas ativas</div>';

                keys.forEach(t => {
                    if(filter && !t.includes(filter)) return;
                    const total = tabs[t].reduce((acc, i) => acc + (i.price * i.qty), 0);
                    list.innerHTML += `
                        <div class="table-card">
                            <div><strong>Mesa ${t}</strong><br><small>R$ ${total.toFixed(2)}</small></div>
                            <button onclick="App.payTable('${t}')" style="background:none; border:1px solid #555; color:white; padding:5px 10px; border-radius:5px;">Fechar</button>
                        </div>
                    `;
                });
            },

            payTable: (t) => {
                if(!confirm(`Fechar Mesa ${t}?`)) return;
                const tabs = JSON.parse(localStorage.getItem('restaurantTabs'));
                const items = tabs[t];
                
                // Grava historico
                const hist = DB.get('restaurantSalesHistory');
                items.forEach(i => hist.push({
                    waiter: i.waiter || 'App', amount: i.price*i.qty, item: i.name, time: new Date().toLocaleTimeString()
                }));
                DB.set('restaurantSalesHistory', hist);

                delete tabs[t];
                localStorage.setItem('restaurantTabs', JSON.stringify(tabs));
                App.renderTables();
            },

            checkNotifs: () => {
                const notifs = DB.get('restaurantNotifications');
                if(notifs.length > 0) {
                    notifs.forEach(n => alert(`ðŸ”” Cozinha: ${n.msg}`)); // Simples alert para garantir atenÃ§Ã£o
                    DB.set('restaurantNotifications', []);
                    if(navigator.vibrate) navigator.vibrate([200,100,200]);
                }
            }
        };

        // --- LÃ“GICA DA SACOLA (CART) ---
        const Cart = {
            open: () => {
                const list = document.getElementById('cart-list');
                list.innerHTML = '';
                
                DB.cart.forEach(item => {
                    list.innerHTML += `
                        <div class="cart-item-row">
                            <div>
                                <strong>${item.name}</strong><br>
                                <small style="color:#aaa">R$ ${item.price.toFixed(2)}</small>
                            </div>
                            <div class="cart-controls">
                                <button class="ctrl-btn minus" onclick="Cart.change(${item.id}, -1)">-</button>
                                <span style="font-weight:bold; width:20px; text-align:center;">${item.qty}</span>
                                <button class="ctrl-btn plus" onclick="Cart.change(${item.id}, 1)">+</button>
                            </div>
                        </div>
                    `;
                });

                // Atualiza total visual da sacola
                const total = DB.cart.reduce((acc, i) => acc + (i.price * i.qty), 0);
                document.getElementById('sheet-total').innerText = `R$ ${total.toFixed(2)}`;

                document.getElementById('cart-overlay').classList.add('open');
                document.getElementById('cart-sheet').classList.add('open');
            },

            close: () => {
                document.getElementById('cart-overlay').classList.remove('open');
                document.getElementById('cart-sheet').classList.remove('open');
                // Atualiza os badges na lista principal caso tenha mudado quantidades
                const activeBtn = document.querySelector('.tab-btn.active');
                if(activeBtn) App.renderProducts(activeBtn.innerText === 'COMIDA' ? 'food' : 'drink');
            },

            change: (id, delta) => {
                const item = DB.cart.find(i => i.id === id);
                item.qty += delta;

                if(item.qty <= 0) {
                    // Remove do array
                    DB.cart = DB.cart.filter(i => i.id !== id);
                }

                App.updateBar(); // Atualiza barra verde fundo
                
                if(DB.cart.length === 0) {
                    Cart.close();
                } else {
                    Cart.open(); // Re-renderiza a lista da sacola
                }
            }
        };

        window.onload = App.init;
    </script>
</body>
</html>
